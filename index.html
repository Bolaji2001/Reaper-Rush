<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reaper Rush v2</title>
<link rel="icon" type="image/x-icon" href="favicon.ico">
<style>
    body {
        margin: 0;
        background: linear-gradient(to bottom, #111, #222);
        overflow: hidden;
        font-family: Arial, sans-serif;
        color: white;
        user-select: none;
        transition: background 0.3s;
    }
    #gameCanvas {
        display: block;
        margin: 0 auto;
        background: radial-gradient(circle at center, #333, #000);
    }
    #score, #lives {
        position: absolute;
        font-size: 1.2rem;
        padding: 10px;
        z-index: 2;
    }
    #score { left: 10px; top: 10px; }
    #lives { right: 10px; top: 10px; }
    #startScreen, #gameOverScreen {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0; left: 0;
        background: rgba(0,0,0,0.8);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        z-index: 3;
    }
    button {
        background: #ffcc00;
        color: #000;
        border: none;
        padding: 10px 20px;
        margin-top: 10px;
        border-radius: 10px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: 0.2s;
    }
    button:hover { background: #ffdb4d; }
    #gambleBtn {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: #9c27b0;
        color: white;
        padding: 8px 16px;
        font-size: 1rem;
        display: none;
    }
</style>
</head>
<body>

<div id="score">Score: 0</div>
<div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>

<canvas id="gameCanvas"></canvas>

<div id="startScreen">
    <h1>‚ò†Ô∏è Reaper Rush ‚ò†Ô∏è</h1>
    <p>Collect üí∞ coins and avoid ‚ò†Ô∏è Reapers!</p>
    <p>üî• Burn Boost: 3 coins in a row = Double Points + Speed!</p>
    <p>üé≤ Press G or Tap Gamble to risk your score!</p>
    <button onclick="startGame()">Play</button>
</div>

<div id="gameOverScreen" style="display:none;">
    <h1>Game Over</h1>
    <p id="finalScore"></p>
    <button onclick="startGame()">Play Again</button>
</div>

<button id="gambleBtn" onclick="gamble()">üé≤ Gamble</button>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let width, height;

function resizeCanvas() {
    width = window.innerWidth;
    height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Game variables
let player, coins, score, lives, gameRunning, speed, touchX;
let streak, burnMode, burnTimer;
let gambleAvailable;

// Player
class Player {
    constructor() {
        this.size = 50;
        this.x = width/2 - this.size/2;
        this.y = height - this.size*2;
        this.speed = 8;
    }
    draw() {
        ctx.fillStyle = "#4CAF50";
        ctx.beginPath();
        ctx.roundRect(this.x, this.y, this.size, this.size, 15);
        ctx.fill();
    }
    move(dir) {
        this.x += dir * this.speed;
        if (this.x < 0) this.x = 0;
        if (this.x + this.size > width) this.x = width - this.size;
    }
}

// Falling object
class FallingItem {
    constructor(type) {
        this.type = type; // "coin" or "reaper"
        this.size = 40;
        this.x = Math.random() * (width - this.size);
        this.y = -this.size;
        this.speed = speed + Math.random() * 3;
    }
    draw() {
        if (this.type === "coin") {
            let gradient = ctx.createRadialGradient(
                this.x + this.size/2, this.y + this.size/2, 5,
                this.x + this.size/2, this.y + this.size/2, this.size/2
            );
            gradient.addColorStop(0, "#fff176");
            gradient.addColorStop(1, "#fbc02d");
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(this.x+this.size/2, this.y+this.size/2, this.size/2, 0, Math.PI*2);
            ctx.fill();
        } else {
            ctx.fillStyle = "#222";
            ctx.beginPath();
            ctx.arc(this.x+this.size/2, this.y+this.size/2, this.size/2, 0, Math.PI*2);
            ctx.fill();
            ctx.fillStyle = "#fff";
            ctx.font = "20px Arial";
            ctx.fillText("‚ò†Ô∏è", this.x+10, this.y+28);
        }
    }
    update() {
        this.y += this.speed * (burnMode ? 1.5 : 1);
    }
}

function startGame() {
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('gameOverScreen').style.display = 'none';
    score = 0;
    lives = 3;
    speed = 3;
    streak = 0;
    burnMode = false;
    burnTimer = 0;
    gambleAvailable = false;
    player = new Player();
    coins = [];
    gameRunning = true;
    spawnItem();
    document.getElementById('gambleBtn').style.display = 'block';
    gameLoop();
}

function spawnItem() {
    if (!gameRunning) return;
    let type = Math.random() < 0.7 ? "coin" : "reaper";
    coins.push(new FallingItem(type));
    setTimeout(spawnItem, Math.random() * 1000 + 500);
}

function update() {
    coins.forEach(item => item.update());

    // Collision detection
    coins.forEach((item, index) => {
        if (item.y + item.size > player.y &&
            item.x < player.x + player.size &&
            item.x + item.size > player.x) {
            if (item.type === "coin") {
                score += burnMode ? 20 : 10;
                streak++;
                if (streak >= 3 && !burnMode) activateBurnMode();
            } else {
                lives -= 1;
                streak = 0;
                burnMode = false;
                document.body.style.background = "linear-gradient(to bottom, #111, #222)";
            }
            coins.splice(index, 1);
        }
    });

    // Remove off-screen
    coins = coins.filter(item => item.y < height + item.size);

    // Burn mode timer
    if (burnMode) {
        burnTimer--;
        if (burnTimer <= 0) {
            burnMode = false;
            document.body.style.background = "linear-gradient(to bottom, #111, #222)";
            if (streak >= 3) {
                score += 100; // Auto LP bonus
                showPopup("+100 LP Bonus!", player.x, player.y - 20, "#00e676");
            }
            streak = 0;
        }
    }

    // Increase difficulty
    speed += 0.001;

    // Enable gamble if score high enough
    gambleAvailable = score >= 100;
    document.getElementById('gambleBtn').style.display = gambleAvailable ? 'block' : 'none';

    if (lives <= 0) endGame();
}

function draw() {
    ctx.clearRect(0, 0, width, height);
    player.draw();
    coins.forEach(item => item.draw());
    document.getElementById('score').innerText = "Score: " + score;
    document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(lives);
}

function gameLoop() {
    if (!gameRunning) return;
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

function endGame() {
    gameRunning = false;
    document.getElementById('finalScore').innerText = `Your Score: ${score}`;
    document.getElementById('gameOverScreen').style.display = 'flex';
    document.getElementById('gambleBtn').style.display = 'none';
}

function activateBurnMode() {
    burnMode = true;
    burnTimer = 60 * 5; // 5 seconds
    document.body.style.background = "linear-gradient(to bottom, #ff5722, #d84315)";
}

function gamble() {
    if (!gambleAvailable) return;
    let gambleAmount = Math.floor(score / 2);
    if (Math.random() < 0.5) {
        score += gambleAmount;
        showPopup("+Gamble Win!", width/2, height/2, "#00e676");
    } else {
        score -= gambleAmount;
        showPopup("Gamble Lost!", width/2, height/2, "#ff1744");
    }
}

function showPopup(text, x, y, color) {
    ctx.fillStyle = color;
    ctx.font = "20px Arial";
    ctx.fillText(text, x, y);
}

// Controls - Keyboard
window.addEventListener('keydown', e => {
    if (e.key === "ArrowLeft") player.move(-1);
    if (e.key === "ArrowRight") player.move(1);
    if (e.key.toLowerCase() === "g") gamble();
});

// Controls - Touch
canvas.addEventListener('touchstart', e => {
    touchX = e.touches[0].clientX;
});
canvas.addEventListener('touchmove', e => {
    let delta = e.touches[0].clientX - touchX;
    player.x += delta * 0.2;
    if (player.x < 0) player.x = 0;
    if (player.x + player.size > width) player.x = width - player.size;
    touchX = e.touches[0].clientX;
});
</script>

</body>
</html>
